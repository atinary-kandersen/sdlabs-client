# SDLabs v2 web client

## Scripts

- `setup`: Runs all required scripts to run the app.
- `dev`: Launches everything needed to develop.
- `build`: Creates a production build in the `dist` folder.
- `preview`: Serves the built solution from the `dist` folder. Remember to run `npm run build` before.
- `test`: Runs all tests.
- `test:node`: Runs all Node environment tests.
- `test:browser`: Runs all browser tests.
- `test:e2e`: Runs all E2E tests. Remember to run `npm run build` before, as this uses the `preview` script to launch to app from dist folder.
- `lint`: Checks all code formatting.
- `format`: Formats all code.
- `json-server:generate`: Generates the json-server json file at `./src/generated/json-server.json`.
- `json-server:run`: Launches a `json-server` instance configured with `./src/generated/json-server.json`.
- `socket-mirror`: Launches a `Socket.IO` web server that mirrors all incoming messages.
- `bundle-visualizer`: Visualizes the bundles.
- `openapi`: Generates OpenAPI types file at `./src/generated/openapi.d.ts`

###

## Folder and file structure

The app source code is divided into two main folders: **app** and **lib**:

```
src
├── app
├── generated
└── lib
```

- **app** - everything specialized (non-reusable) for the app, such as the main layout (ie. header, footer), pages (discussed below), configuration etc.
- **generated** - Typescript types and schemas etc., generated by scripts.
- **lib** - presentational components and utilities.

A detailed example of the structure:

```
src
├── app
│   ├── config
│   │   ├── api.ts
│   │   ├── environment.ts
│   │   ├── localization.ts
│   │   ├── logging.ts
│   │   └── socket.ts
│   ├── components
│   │   ├── Footer
│   │   └── Header
│   ├── routes
│   │   ├── analytics
│   │   ├── datasets
│   │   ├── experiments
│   │   │   ├── ExperimentsRoute.tsx
│   │   │   └── ExperimentsRoute.module.css
│   │   ├── userProfile
│   │   └── welcome
│   ├── queries
│   │   ├── analytics.ts
│   │   ├── experiments.ts
│   │   ├── datasets.ts
│   │   └── users.ts
│   ├── state
│   │   ├── actions.ts
│   │   ├── useGlobalState.ts
│   │   ├── useUserState.ts
│   │   └── useThemeState.ts
│   ├── App.tsx
│   ├── App.module.css
│   ├── main.tsx
│   ├── index.css
│   ├── Router.tsx
│   generated
│   ├── api.ts
│   └── other.ts
└── lib
    ├── common
    │   ├── components
    │   │   ├── FormatData
    │   │   ├── FormatBytes
    │   │   ├── LearnMore
    │   │   └── Stepper
    │   └── styles
    │       └── commonStyles.module.css
    ├── features
    │   ├── experiments
    │   └── user
    │       ├── UserDetails.ts
    │       ├── UserDetails.module.css
    │       ├── UserList.ts
    │       ├── UserList.module.css
    │       ├── UserListItem.ts
    │       └── UserListItem.module.css
    └── utils
        ├── formatDate.ts
        └── formatNumber.ts
```

## VS Code setup

Install recommended extensions listed in `.vscode/extensions.json`.

## Resources

Please read and understand the following resources, as they are used extensively in the app.

- [Practical React Query](https://tkdodo.eu/blog/practical-react-query)
- [Mantine | Learn](https://mantine.dev/getting-started/#learn)

## Testing

Tests are divided into three categories:

- **Node tests** (`src/**/*.test.node.ts`): running in the Node environment.
- **Browser tests** (`src/**/*.test.browser.tsx`): running in a browser. This is for testing components.
- **E2E tests** (`src/e2e/**/*.test.e2e.ts`): which launches the entire app from the `dist` folder, and performs E2E tests on it.

### Node tests

Node tests test code that does not depend on the Web API (a browser), and thus can be executed in a Node environment. These tests are by far the most performant, and thus should be prioritized whenever possible.

### Browser tests

We test components in a real browser, not virtual environments like `jsdom` or `happy-dom`.

### E2E tests

E2E tests perform user-like actions in the app, including routing, and make assertions on these actions.

https://playwright.dev/docs/writing-tests

## Mantine

## CSS

A combination of global styles and CSS Modules is used, CSS Modules being how component-specific styles are scoped to its component.

### Layout

We use [Web Awesome's layout style utilities](https://backers.webawesome.com/docs/layout/) for layout.

## Icons

We use [Font Awesome](https://fontawesome.com/icons) for icons and Web Awesome's [`wa-icon`](https://backers.webawesome.com/docs/components/icon/) web component to render icons. The reason is that the `wa-icon` component works well with FontAwsome.

## Container components and Presentational components

There are two types of components, _container_ components and _presentational_ components.

#### Container components

Presentational components handle tasks such as state, fetching data from APIs and sending and receiving websocket messages. Then they render one or more presentational components, which are fed data via props.

#### Presentational components

Presentational components strictly adhere to React's [unidirectional data flow](https://how.dev/answers/what-is-unidirectional-data-flow-in-react) pattern. They receive all their data via props and communicate to their containing components via callback methods (kind of like emitting events).

**Note**: Presentational components can render other presentational components, but never a container component.
